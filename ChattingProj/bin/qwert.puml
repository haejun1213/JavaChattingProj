@startuml

start

title 채팅 서버 워크플로우

:서버 시작;
:서버 소켓을 설정하고 클라이언트 연결을 기다림;

while (클라이언트가 연결되었나?) is (예)
    :클라이언트 연결을 수락;
    :새로운 ClientService 인스턴스를 생성;
    
    while (클라이언트가 채팅 이름을 제공했나?) is (예)
        :채팅 이름을 확인 (고유한지 검사);
        if (채팅 이름이 고유한가?) then (예)
            :클라이언트 이름을 chatClientInfo에 추가;
            :클라이언트와 연결 완료;
        else (아니오)
            :다른 이름을 요청;
        endif
    endwhile
    
    while (클라이언트가 상호작용을 하는 동안) is (예)
        :클라이언트가 메시지를 보냄;
        
        if (메시지가 공개 메시지인가?) then (예)
            :모든 클라이언트에게 메시지를 전달;
        else (개인 메시지)
            :상대방에게 개인 메시지 전송;
            if (상대방이 오프라인이라면) then (예)
                :클라이언트에게 "상대방이 오프라인입니다" 메시지 전송;
            endif
        endif
        
        :클라이언트가 이미지 파일을 요청하면;
        :이미지 데이터 저장 또는 전송;
        
        :클라이언트가 이름 변경 요청 시;
        :새로운 이름이 고유한지 확인 후 변경;
    endwhile
    
    :클라이언트가 종료 명령어를 입력;
    :클라이언트의 정보를 chatClientInfo에서 삭제;
    :서버 종료;
endwhile

if (서버가 종료되었나?) then (예)
    :서버 소켓 닫기;
endif

stop

@enduml
